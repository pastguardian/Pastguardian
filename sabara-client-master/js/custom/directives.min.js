"use strict";app.directive("loginPanel",function(){return{restrict:"C",link:function($scope,elm){$("#username").val("").focus();KeyboardJS.on("enter",function(){$("#login-btn").click()})}}});app.directive("reload",function(){return{restrict:"A",link:function($scope,elm){elm.on("click",function(e){location.reload(true)})}}});app.directive("tooltips",function(){return{restrict:"C",link:function($scope,elm,attrs){return attrs.$observe("title",function(v){elm.tooltip({placement:attrs.placement||"top"})})}}});app.directive("select2",function(){return{restrict:"C",link:function($scope,elm,attrs){elm.select2()}}});app.directive("select2Idpel",function(){return{restrict:"C",require:"?ngModel",link:function($scope,elm,attrs,ctrl){elm.select2({placeholder:"Ketik IDPEL",minimumInputLength:2,ajax:{url:$scope.server+"/listidpel",type:"GET",dataType:"json",data:function(term,page){if(angular.isUndefined(attrs.ganda))return{q:term,u:angular.isUndefined($scope.user.id_unit)?"":$scope.user.id_unit};else return{q:term,u:angular.isUndefined($scope.user.id_unit)?"":$scope.user.id_unit,g:1}},results:function(data,page){return{results:data}},formatResult:function(idpel){return""+idpel.nama+""},formatSelection:function(idpel){return idpel.id}}}).on("change",function(e){ctrl.$setViewValue(e.val);$scope.$apply()})}}});app.directive("select2Rbm",function(){return{restrict:"C",require:"?ngModel",link:function($scope,elm,attrs,ctrl){elm.select2({placeholder:"Ketik RBM",minimumInputLength:2,ajax:{url:$scope.server+"/listrbm",type:"GET",dataType:"json",data:function(term,page){return{q:term,u:attrs.unit}},results:function(data,page){return{results:data}},formatResult:function(rbm){return""+rbm.nama+""},formatSelection:function(rbm){return rbm.id}}}).on("change",function(e){ctrl.$setViewValue(e.val);$scope.$apply()})}}});app.directive("imagePreview",function(){return{restrict:"A",link:function($scope,elm,attrs){elm.on("click",function(e){e.preventDefault();var href=attrs.target;if($("#lightbox").length>0){$("#light-content").html('<img src="'+href+'" />');$("#lightbox").fadeIn()}else{var lightbox='<div id="lightbox" style="display: none">'+'<div id="light-content" class="scrollable">'+'<img src="'+href+'" />'+"</div>"+"</div>";$("body").append(lightbox);$("#lightbox").fadeIn()}$("#lightbox").on("click",function(){$("#lightbox").fadeOut()})})}}});app.directive("resetKoreksi",function(){return function($scope,elm,attrs){elm.on("click",function(e){$scope.resetKoreksi();$(attrs.resetKoreksi).val("").select2("data",null);$scope.$apply()})}});app.directive("resetBaca",function(){return function($scope,elm,attrs){elm.on("click",function(e){$scope.resetBaca();$(attrs.resetBaca).val("").select2("data",null);$scope.$apply()})}});app.directive("datepicker",function(){return{require:"?ngModel",restrict:"A",link:function($scope,elm,attrs,ctrl){elm.keypress(function(e){e.preventDefault()}).keyup(function(e){e.preventDefault()}).datepicker({format:"dd/mm/yyyy",autoclose:true}).on("changeDate",function(evt){ctrl.$setViewValue(new Date(evt.date).toString("dd/MM/yyyy"));$scope.$apply()})}}});app.directive("fileInput",function(){return function($scope,elm,attrs){if(angular.isUndefined(attrs.multiple))elm.on("change",function(e){$scope.file=e.target.files[0]});else elm.on("change",function(e){$scope.file=e.target.files})}});app.directive("fileInputPreview",function(){return function($scope,elm,attrs){elm.on("change",function(e){var file=e.target.files[0];var reg=new RegExp("^("+$scope.koreksi.idpel+")_([0-9]{6,6}).(jpg|jpeg|png)$");if(!file.name.match(reg)){alertify.error("Nama file tidak sesuai");$(attrs.fileInputPreview).attr("src",$scope.server+"/"+$scope.plggn.foto);return false}$scope.file=e.target.files[0];console.log($scope.file);var $btn=$(elm.closest("div").find("button")[0]);$btn.one("click",function(e){$(attrs.fileInputPreview).attr("src",$scope.server+"/"+$scope.plggn.foto)});$scope.$apply();var reader=new FileReader;reader.onload=function(tfile){return function(e){$(attrs.fileInputPreview).attr("src",e.target.result)}}(file);reader.readAsDataURL(file);elm.val("")})}});app.directive("countStand",function(){var count=function(s,n){var n0=parseFloat(s.toString().replace(",","."));var va=parseFloat(n.replace(",","."));if(va<n0)var t=99999-(n0+va);else var t=va-n0;return!isNaN(t)?t.toFixed(2).toString().replace(".",","):"0"};return function($scope,elm,attrs){elm.on("keyup",function(e){var n0,n,t,va;var source,target;switch(attrs.countStand){case"lwbp":$scope.pelanggan.plwbp=count($scope.pelanggan.lwbp0,elm.val());break;case"wbp":$scope.pelanggan.pwbp=count($scope.pelanggan.wbp0,elm.val());break;case"kvarh":$scope.pelanggan.pkvarh=count($scope.pelanggan.kvarh0,elm.val());break}$scope.$apply()})}});app.directive("countStandKoreksi",function(){var count=function(s,n){var n0=parseFloat(s.toString().replace(",","."));var va=parseFloat(n.replace(",","."));var t=va-n0;return!isNaN(t)?t.toFixed(2).toString().replace(".",","):"0"};return function($scope,elm,attrs){elm.on("keyup",function(e){var n0,n,t,va;var source,target;switch(attrs.countStandKoreksi){case"lwbp":$scope.plggn.plwbp=count($scope.plggn.lwbp0,elm.val());break;case"wbp":$scope.plggn.pwbp=count($scope.plggn.wbp0,elm.val());break;case"kvarh":$scope.plggn.pkvarh=count($scope.plggn.kvarh0,elm.val());break}$scope.$apply()})}});app.directive("numberInput",function(){return function($scope,elm){elm.keypress(function(e){var c=e.keyCode||e.charCode;switch(c){case 8:case 9:case 27:case 44:case 13:return;case 65:if(e.ctrlKey===true)return}if(c<45||c>57){e.preventDefault()}})}});app.directive("loadMap",["$cookies","$http",function($cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){$scope.resetKoordinat();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/rbm/"+attrs.loadMap,method:"GET"}).success(function(d){var $exbtn=$("#link-map-open");if(d.center.length==0)return alertify.error("RBM tidak memiliki data peta");$exbtn.attr("href","#/map/rbm/"+attrs.loadMap);$scope.setKoordinat(d);var center=d.center,data=d.data,div=document.getElementById(attrs.container);var latlng=new google.maps.LatLng(center[0],center[1]);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt);var marker=new MarkerWithLabel({position:pos,map:map,title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}var rutePath=new google.maps.Polyline({path:nodes,geodesic:true,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:1});rutePath.setMap(map)})})}}]);app.directive("loadMapGardu",["$cookies","$http",function($cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){$scope.resetKoordinat();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/gardu/"+attrs.loadMapGardu,method:"GET"}).success(function(d){if(d.center.length==0)return alertify.error("Gardu tidak memiliki data peta");$scope.setKoordinat(d);$("#link-map-open").attr("href","#/map/gardu/"+attrs.loadMapGardu);var center=d.center,data=d.data,div=document.getElementById(attrs.container);var latlng=new google.maps.LatLng(center.lat,center.longt);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;var marker=new MarkerWithLabel({position:new google.maps.LatLng(center.lat,center.longt),map:map,title:center.nama,labelContent:center.nama,icon:"img/tiang.png"});for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt);var marker=new MarkerWithLabel({position:pos,map:map,title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}})})}}]);app.directive("loadMap2",["$cookies","$http",function($cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){$scope.resetKoordinat();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/tagihan/"+attrs.loadMap2,method:"GET"}).success(function(d){if(d.center.length==0)return alertify.error("RBM tidak memiliki data peta");if(d.data.length==0)return alertify.error("RBM tidak memiliki data peta");$scope.setKoordinat(d);$scope.showMapContainer();$("#link-map-open").attr("href","#/map/tagihan/"+attrs.loadMap2);var center=d.center,data=d.data,div=document.getElementById(attrs.container);var latlng=new google.maps.LatLng(center.lat,center.longt);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt),color=ds.status==0?"red":"blue";var marker=new MarkerWithLabel({position:pos,map:map,icon:"http://maps.google.com/mapfiles/ms/icons/"+color+"-dot.png",title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}})})}}]);app.directive("mapAutoLoader",["$cookies","$http",function($cookies,$http){return{restrict:"CA",link:function($scope,elm,attrs){if($scope.type=="gardu"){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/gardu/"+$scope.param,method:"GET"}).success(function(d){var center=d.center,data=d.data,div=document.getElementById("map-container");var latlng=new google.maps.LatLng(center.lat,center.longt);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;var marker=new MarkerWithLabel({position:new google.maps.LatLng(center.lat,center.longt),map:map,title:center.nama,labelContent:center.nama,icon:"img/tiang.png"});for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt);var marker=new MarkerWithLabel({position:pos,map:map,title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}})}if($scope.type=="rbm"){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/rbm/"+$scope.param,method:"GET"}).success(function(d){if(d.center.length==0)return alertify.error("RBM tidak memiliki data peta");var center=d.center,data=d.data,div=document.getElementById("map-container");var latlng=new google.maps.LatLng(center[0],center[1]);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt);var marker=new MarkerWithLabel({position:pos,map:map,title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}var rutePath=new google.maps.Polyline({path:nodes,geodesic:true,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:1});rutePath.setMap(map)})}if($scope.type=="tagihan"){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/map/tagihan/"+$scope.param,method:"GET"}).success(function(d){var center=d.center,data=d.data,div=document.getElementById("map-container");var latlng=new google.maps.LatLng(center.lat,center.longt);var Opts={zoom:16,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var map=new google.maps.Map(div,Opts);google.maps.event.trigger(map,"resize");var nodes=[];var iw=new google.maps.InfoWindow;for(var i=0;i<data.length;i++){var ds=data[i],pos=new google.maps.LatLng(ds.lat,ds.longt),color=ds.status==0?"red":"blue";var marker=new MarkerWithLabel({position:pos,map:map,icon:"http://maps.google.com/mapfiles/ms/icons/"+color+"-dot.png",title:ds.idpel+" - "+ds.nama,labelContent:ds.urut,labelAnchor:new google.maps.Point(5,33),labelClass:"labels",labelInBackground:false,constring:'<TABLE ALIGN="center">'+"<TR>"+'<TH ROWSPAN=10><img src="'+$scope.server+"/img/"+ds.idpel+"/"+ds.bulan+'" width=180></img></TH>'+"<TD>Tarif/Daya </TD>"+"<TD> : "+ds.tarif+"/"+ds.daya+"</TD>"+"</TR>"+"<TR>"+"<TD>LWBP</TD>"+"<TD> : "+ds.stan+"</TD>"+"</TR>"+"<TR>"+"<TD>Tgl Baca</TD>"+"<TD> : "+ds.waktu+"</TD>"+"</TR>"+"<TR>"+"<TD>Koduk</TD>"+"<TD> : "+ds.koduk+"</TD>"+"</TR>"+"</TABLE>"});google.maps.event.addListener(marker,"click",function(){iw.setContent(this.constring);iw.open(map,this)});nodes.push(pos)}})}}}}]);app.directive("loadPelanggan",["$cookies","$http",function($cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){$http({url:$scope.server+"/stand/"+attrs.loadPelanggan,method:"GET"}).success(function(d){$scope.setPelanggan(d);$("#e2-lwbp2").focus()})})}}]);app.directive("printPopup",["$cookies","$http","loader",function($cookies,$http,loader){return function($scope,elm,attrs){elm.on("click",function(){loader.show();$http({url:attrs.target,method:"GET"}).success(function(d){loader.hide();var mywindow=window.open("","new div","height=400,width=600");mywindow.document.write(d);mywindow.print();mywindow.close();return true}).error(function(e,s,h){loader.hide()})})}}]);app.directive("lineChart",["$http","$cookies",function($http,$cookies){return{restrict:"A",link:function($scope,elm,attrs){var draw=function(title,subtitle,categories,series){elm.highcharts({title:{text:title,x:-20},subtitle:{text:subtitle,x:-20},xAxis:{categories:categories},credits:{enabled:true,text:"SABARA",href:"http://nazoftware.blogspot.com"},yAxis:{title:{text:attrs.ytitle},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:series})};var loadData=function(){elm.fadeOut();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:attrs.target,method:"GET"}).success(function(d){elm.fadeIn();draw(d.title,d.subtitle,d.categories,d.series);$scope.setLoadGraph(0)}).error(function(e,s,h){elm.show()})};attrs.$observe("load",function(v){if(attrs.load>0)loadData()})}}}]);app.directive("deleteUnit",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){alertify.confirm('<strong class="text-danger">PERINGATAN: Data unit yang dihapus tidak dapat dikembalikan</strong><br><br><strong>Apakah Anda yakin?</strong>',function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/unit/"+attrs.deleteUnit,method:"DELETE"}).success(function(d){loader.hide();$scope.loadUnit();alertify.success("Data unit berhasil dihapus")}).error(function(e,s,h){loader.hide()});$scope.$apply()}})})}}]);app.directive("deleteBlth",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){alertify.confirm("<strong>Apakah Anda yakin?</strong>",function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/blth/"+attrs.deleteBlth,method:"DELETE"}).success(function(d){loader.hide();$scope.setBlth(d);alertify.success("Data bulan tahun berhasil dihapus")}).error(function(e,s,h){loader.hide()})}})})}}]);app.directive("deleteGardu",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){alertify.confirm("<strong>Apakah Anda yakin?</strong>",function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/gardu/"+attrs.deleteGardu,method:"DELETE"}).success(function(d){loader.hide();$scope.loadGardu();alertify.success("Data gardu berhasil dihapus")}).error(function(e,s,h){loader.hide()})}})})}}]);app.directive("deletePetugas",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){if($scope.submenu=="petugas")var m='<strong class="text-danger">PERINGATAN: Data petugas berhubungan dengan RBM, pastikan petugas tidak memiliki RBM.</strong><br><br><strong>Apakah Anda yakin?</strong>';else var m='<strong class="text-danger">PERINGATAN: Data koordinator yang dihapus tidak dapat dikembalikan lagi.</strong><br><br><strong>Apakah Anda yakin?</strong>';alertify.confirm(m,function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/"+$scope.submenu+"/"+attrs.deletePetugas,method:"DELETE"}).success(function(d){loader.hide();$scope.searchPetugas();alertify.success("Data "+$scope.submenu+" berhasil dihapus")}).error(function(e,s,h){loader.hide()})}})})}}]);app.directive("deleteAdmin",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){alertify.confirm('<strong class="text-danger">PERINGATAN: Data '+$scope.submenu+" yang dihapus tidak dapat dikembalikan lagi.</strong><br><br><strong>Apakah Anda yakin?</strong>",function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/"+$scope.submenu+"/"+attrs.deleteAdmin,method:"DELETE"}).success(function(d){loader.hide();$scope.loadAdmin();alertify.success("Data "+$scope.submenu+" berhasil dihapus")}).error(function(e,s,h){loader.hide()})}})})}}]);app.directive("deleteRbm",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){alertify.confirm('<strong class="text-danger">PERINGATAN: Data '+$scope.submenu+" yang dihapus tidak dapat dikembalikan lagi.</strong><br><br><strong>Apakah Anda yakin?</strong>",function(e){if(e){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/rbm/"+attrs.deleteRbm,method:"DELETE"}).success(function(d){loader.hide();$scope.loadRbm();alertify.success("Data RBM berhasil dihapus")}).error(function(e,s,h){loader.hide()})}})})}}]);"use strict";app.directive("saveLogin",["$http","$location","loader",function($http,$location,loader){return function($scope,elm){elm.on("click",function(){var username=$("#username").val(),password=$("#password").val();if(username.length==0||password.length==0)return;loader.show();$http({url:$scope.server+"/login",method:"POST",data:$scope.userform}).success(function(d){loader.hide();$scope.setUser(d);return $location.path("/home").replace()}).error(function(e,s,h){loader.hide();if(s==401){alertify.error("Data login salah!. Ulangi memasukkan data atau hubungi Administrator")}if(s==500){alertify.error("Server merespon dengan tidak benar. Hubungi Administrator")}})})}}]);app.directive("activateBlth",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(){$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();var s=$scope.blth[attrs.activateBlth],a={id:s.id,nama:s.nama,status:1};$http({url:$scope.server+"/blth/"+a.id,method:"POST",data:a}).success(function(d){loader.hide();$scope.setBlth(d)}).error(function(e,s,h){loader.hide()});$scope.$apply()})}}]);app.directive("saveBlth",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm){elm.on("click",function(){var nama=$("#blth-nama").val();if(nama.length<6)return alertify.error("Nama bulan tahun tidak boleh kosong");$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);var url=$scope.bt.id==0?$scope.server+"/blth":$scope.server+"/blth/"+$scope.bt.id;loader.show();$http({url:url,method:"POST",data:$scope.bt}).success(function(d){loader.hide();$scope.setBlth(d);$scope.resetBt()}).error(function(e,s,h){loader.hide()})})}}]);app.directive("saveUnit",["loader","$http","$cookies",function(loader,$http,$cookies){return function($scope,elm){elm.on("click",function(){var nama=$("#nama").val(),kode=$("#kode").val();if(nama.length<2)return alertify.error("Nama unit tidak boleh kosong");if(kode.length<2)return alertify.error("Kode unit tidak boleh kosong");$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);var url=$scope.unit.id==0?$scope.server+"/unit":$scope.server+"/unit/"+$scope.unit.id;loader.show();$http({url:url,method:"POST",data:$scope.unit}).success(function(d){alertify.success("Data berhasil disimpan");loader.hide();$scope.loadUnit();$scope.resetUnit()}).error(function(e,s,h){loader.hide()})})}}]);app.directive("saveGardu",["loader","$http","$cookies",function(loader,$http,$cookies){return function($scope,elm){elm.on("click",function(){var nama=$("#g-nama").val();if(nama.length<2)return alertify.error("Nama gardu tidak boleh kosong");if($scope.gardu.unit==0)return alertify.error("Anda belum memilih unit");$scope.egardu.unit=$scope.gardu.unit;$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);var url=$scope.egardu.id==0?$scope.server+"/gardu":$scope.server+"/gardu/"+$scope.egardu.id;loader.show();$http({url:url,method:"POST",data:$scope.egardu}).success(function(d){alertify.success("Data berhasil disimpan");loader.hide();$scope.resetGardu();$scope.loadGardu()}).error(function(e,s,h){loader.hide()})})}}]);app.directive("saveNpde",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm){var resend=function(){$http({url:$scope.server+"/npde/resend",method:"GET"}).success(function(d){if(d.progress==1){resend()}else loader.hide();$scope.setProgress(d.progress);$scope.$apply()}).error(function(e,s,h){loader.hide()})};elm.on("click",function(){if($scope.file===null||$scope.file.length==0)return alertify.error("Anda belum memilih file NPDE");var fd=new FormData;fd.append("file",$scope.file);var xhr=new XMLHttpRequest;xhr.open("post",$scope.server+"/npde/"+$scope.impor.tipe,true);xhr.setRequestHeader("Authorization","Basic "+Base64.encode($cookies.username+":"+$cookies.password));xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("X-File-Name",$scope.file.name);xhr.setRequestHeader("X-File-Size",$scope.file.size);xhr.upload.onprogress=function(e){loader.show()};xhr.onload=function(){var r=angular.fromJson(this.responseText);$scope.setResult(r.result);$scope.setProgress(r.progress);if(r.progress==1){resend()}else{loader.hide();alertify.success("Data berhasil diproses. Periksa di menu Rekap Penerimaan Data")}$scope.$apply()};xhr.onerror=function(){loader.hide()};xhr.send(fd)})}}]);app.directive("saveNpp",["loader","$cookies",function(loader,$cookies){return function($scope,elm){elm.on("click",function(){if($scope.file===null||$scope.file.length==0)return alertify.error("Anda belum memilih file");if($scope.npp.jenis==="")return alertify.error("Anda belum memilih jenis data");var fd=new FormData;fd.append("file",$scope.file);var xhr=new XMLHttpRequest;xhr.open("post",$scope.server+"/npp/"+$scope.npp.jenis,true);xhr.setRequestHeader("Authorization","Basic "+Base64.encode($cookies.username+":"+$cookies.password));xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.upload.onprogress=function(e){loader.show()};xhr.onload=function(){var r=angular.fromJson(this.responseText);if(r.error.length==0){$scope.result=r;loader.hide();alertify.success("Data berhasil diproses!")}else alertify.error("Data gagal diproses!");$scope.$apply()};xhr.onerror=function(){loader.hide()};xhr.send(fd)})}}]);app.directive("saveStmt",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm){elm.on("click",function(){if($scope.ekspor.unit==0)return alertify.error("Anda belum memilih unit");if($scope.ekspor.kode==0)return alertify.error("Anda belum memilih kode proses");$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);loader.show();$http({url:$scope.server+"/stmt?"+jQuery.param($scope.ekspor),method:"GET"}).success(function(d){loader.hide();if(d.file=="")return alertify.error("Tidak ada data yang diekspor");window.location=$scope.server+"/"+d.file}).error(function(e,s,h){loader.hide()})})}}]);app.directive("searchStand",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm){elm.on("click",function(){if($scope.entry.unit==0)return alertify.error("Anda belum memilih unit");if($scope.entry.rbm==""&&$scope.entry.idpel==""&&$scope.entry.nometer==""){$scope.resetPelangganList();$scope.resetPelanggan();$scope.$apply();return alertify.error("Anda harus mengisi salah satu input")}$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);var url=$scope.server+"/liststand?"+jQuery.param($scope.entry);if($scope.entry.rbm!=""){$scope.entry.idpel=$scope.entry.nometer="";loader.show();$http({url:url,method:"GET"}).success(function(d){loader.hide();$scope.setPelangganList(d);$scope.resetPelanggan()}).error(function(e,s,h){loader.hide()});$scope.$apply()}if($scope.entry.idpel!=""){$scope.entry.rbm=$scope.entry.nometer="";loader.show();$http({url:url,method:"GET"}).success(function(d){loader.hide();$scope.resetPelangganList();if(angular.isUndefined(d.idpel))return alertify.error("Data pelanggan sudah terisi");$scope.setPelanggan(d)}).error(function(e,s,h){loader.hide()});$scope.$apply()}if($scope.entry.nometer!=""){$scope.entry.rbm=$scope.entry.idpel="";loader.show();$http({url:url,method:"GET"}).success(function(d){loader.hide();$scope.resetPelangganList();if(angular.isUndefined(d.idpel))return alertify.error("Data pelanggan sudah terisi");$scope.setPelanggan(d)}).error(function(e,s,h){loader.hide()});$scope.$apply()}})}}]);app.directive("searchStandKoreksi",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm){elm.on("click",function(e){if($scope.koreksi.idpel==""&&$scope.koreksi.nometer=="")return alertify.error("Anda harus mengisi salah satu input");loader.show();$http({url:$scope.server+"/liststandkoreksi?"+jQuery.param($scope.koreksi),method:"GET"}).success(function(d){loader.hide();if(angular.isUndefined(d.idpel)){$scope.resetPlggn();return alertify.error("Tidak ada data pelanggan yang dapat dikoreksi")}$scope.setPlggn(d)}).error(function(e,s,h){loader.hide()});$scope.$apply()})}}]);app.directive("saveEntryStand",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.pelanggan.ketbaca!="5"){if($scope.pelanggan.lwbp==""||$scope.pelanggan.lwbp===null)return alertify.error("Anda belum mengisi LWBP")}if($scope.isGanda($scope.pelanggan.tarif,$scope.pelanggan.daya)){if($scope.pelanggan.wbp=="")return alertify.error("Anda belum mengisi WBP")}loader.show();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/stand",method:"POST",data:$scope.pelanggan}).success(function(d){loader.hide();alertify.success("Data stand berhasil disimpan");$scope.resetPelanggan();if($scope.pelangganList.length>0){$("#search-stand").click()}else{$scope.entry.idpel=$scope.entry.nometer=$scope.entry.rbm=""}}).error(function(e,s,h){alertify.error("Data gagal diproses!");loader.hide()})})}}]);app.directive("saveStandKoreksi",["loader","$cookies",function(loader,$cookies){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.plggn.lwbp=="")return alertify.error("Anda belum mengisi LWBP");if($scope.isGanda($scope.plggn.tarif,$scope.plggn.daya)){if($scope.plggn.wbp=="")return alertify.error("Anda belum mengisi WBP")}var fd=new FormData;fd.append("file",$scope.file);for(var i in $scope.plggn)fd.append(i,$scope.plggn[i]);var xhr=new XMLHttpRequest;xhr.open("POST",$scope.server+"/koreksi",true);xhr.setRequestHeader("Authorization","Basic "+Base64.encode($cookies.username+":"+$cookies.password));xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.upload.onprogress=function(e){loader.show()
};xhr.onload=function(){loader.hide();alertify.success("Data stand berhasil disimpan");$scope.resetPlggn();$scope.koreksi.idpel=$scope.koreksi.nometer="";$scope.$apply()};xhr.onerror=function(){};xhr.send(fd)})}}]);app.directive("saveBaca",["loader","$cookies",function(loader,$cookies){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.file===null||$scope.file.length==0)return alertify.error("Anda belum memilih file hasil pembacaan");var fd=new FormData;fd.append("file",$scope.file);var xhr=new XMLHttpRequest;xhr.open("POST",$scope.server+"/bacameter",true);xhr.setRequestHeader("Authorization","Basic "+Base64.encode($cookies.username+":"+$cookies.password));xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.upload.onprogress=function(e){loader.show()};xhr.onload=function(){loader.hide();var r=angular.fromJson(this.responseText);$scope.setReport(r);if(r.total=="0")alertify.error("Tidak ada data yang diproses");else alertify.success("Data berhasil diproses");$scope.$apply()};xhr.onerror=function(){};xhr.send(fd)})}}]);app.directive("saveFoto",["loader","$cookies",function(loader,$cookies){return function($scope,elm,attrs){$("#hidden_upload").on("load",function(){loader.hide();alertify.success("Data foto berhasil diproses.")});elm.on("click",function(e){if($("#file-foto").val().length==0){e.preventDefault();return alertify.error("Anda belum memilih file foto")}loader.show();var $form=$("#form-upload").attr("action",$scope.server+"/foto");$form.submit()})}}]);app.directive("savePetugas",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.modePetugas=="edit"||$scope.modePetugas=="show"){if($scope.petugas.id_unit==0)return alertify.error("Anda belum memilih unit");if($scope.petugas.nama.length<3)return alertify.error("Anda belum memilih mengisi nama");if($scope.petugas.username.length<4)return alertify.error("Anda belum memilih mengisi username")}if($scope.modePetugas=="password"||$scope.modePetugas=="show"){if($scope.petugas.password.length<6)return alertify.error("Password minimal enam karakter")}loader.show();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/"+$scope.submenu,method:"POST",data:$scope.petugas}).success(function(d){loader.hide();alertify.success("Data "+$scope.submenu+" berhasil disimpan");$scope.resetPetugas();$scope.loadPetugas()}).error(function(e,s,h){alertify.error("Data gagal diproses!");loader.hide()})})}}]);app.directive("saveAdmin",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.modeAdmin=="edit"||$scope.modeAdmin=="show"){if(angular.isUndefined($scope.admin.username))return alertify.error("Anda belum memilih mengisi username");if($scope.admin.username.length<4)return alertify.error("Anda belum memilih mengisi username")}if($scope.modeAdmin=="password"||$scope.modePetugas=="show"){if($scope.admin.password.length<6)return alertify.error("Password minimal enam karakter")}loader.show();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/"+$scope.submenu,method:"POST",data:$scope.admin}).success(function(d){loader.hide();alertify.success("Data "+$scope.submenu+" berhasil disimpan");$scope.resetAdmin();$scope.loadAdmin()}).error(function(e,s,h){alertify.error("Data gagal diproses!");loader.hide()})})}}]);app.directive("savePassword",["loader","$cookies","$http",function(loader,$cookies,$http){return function($scope,elm,attrs){elm.on("click",function(e){if($scope.passtoedit.pass1.length<6)return alertify.error("Password minimal enam karakter");if($scope.passtoedit.pass1!=$scope.passtoedit.pass2)return alertify.error("Password tidak sama");$("#pass-modal").modal("hide");loader.show();$http.defaults.headers.common["Authorization"]="Basic "+Base64.encode($cookies.username+":"+$cookies.password);$http({url:$scope.server+"/password",method:"POST",data:{pass1:$scope.passtoedit.pass1,pass2:$scope.passtoedit.pass2,id:$scope.user.id}}).success(function(d){loader.hide();alertify.success("Password Anda berhasil diubah");$scope.resetPassToEdit();$scope.disconnect()}).error(function(e,s,h){loader.hide()})})}}]);